(()=>{var e={726:()=>{const e=["gif","jpeg","jpg","png"],t=document.querySelector(".ad-form"),n=t.querySelector(".ad-form-header__input"),o=t.querySelector(".ad-form-header__preview img"),r=t.querySelector(".ad-form__input"),a=document.createElement("img");n.addEventListener("change",(()=>{const t=n.files[0],r=t.name.toLowerCase();if(e.some((e=>r.endsWith(e)))){const e=new FileReader;e.addEventListener("load",(()=>{o.src=e.result,o.setAttribute("width","70"),o.setAttribute("height","70")})),e.readAsDataURL(t)}})),r.addEventListener("change",(()=>{const n=r.files[0],o=n.name.toLowerCase();if(e.some((e=>o.endsWith(e)))){const e=new FileReader;e.addEventListener("load",(()=>{a.src=e.result,a.setAttribute("width","70"),a.setAttribute("height","70"),t.querySelector(".ad-form__photo").appendChild(a)})),e.readAsDataURL(n)}}))}},t={};function n(o){var r=t[o];if(void 0!==r)return r.exports;var a=t[o]={exports:{}};return e[o](a,a.exports,n),a.exports}(()=>{"use strict";const e=document.querySelector(".map__filters"),t=e.children,o=document.querySelector(".ad-form"),r=o.querySelector(".ad-form__submit"),a=o.querySelectorAll("fieldset"),l=document.querySelector("#address"),c=document.querySelector(".ad-form__reset"),i=o.querySelector("#type"),s=o.querySelector("#price"),d=o.querySelector("#timein"),u=o.querySelector("#timeout"),p=o.querySelector("#title"),m=o.querySelector("#room_number"),y=o.querySelector("#capacity"),f=y.querySelectorAll("option"),v=new Map;v.set("flat","1000"),v.set("bungalow","0"),v.set("house","5000"),v.set("palace","10000");const h=new Map;h.set("1",["1"]),h.set("2",["1","2"]),h.set("3",["1","2","3"]),h.set("100",["0"]),s.placeholder=v.get(i.value);const g=()=>{o.reset(),e.reset(),D()};c.addEventListener("click",(e=>{e.preventDefault(),g()}));const S=function({lat:e,lng:t}){l.value=e.toFixed(5)+", "+t.toFixed(5)};i.addEventListener("change",(()=>{s.placeholder=v.get(i.value),s.min=v.get(i.value)})),d.addEventListener("change",(()=>{u.value=d.value})),u.addEventListener("change",(()=>{d.value=u.value})),p.addEventListener("invalid",(()=>{p.validity.tooShort?p.setCustomValidity("Заголовок должен состоять минимум из 30-ти символов"):p.validity.tooLong?p.setCustomValidity("Заголовок не должен превышать 100 символов"):p.validity.valueMissing?p.setCustomValidity("Обязательное поле"):p.setCustomValidity("")})),p.addEventListener("input",(()=>{p.reportValidity()})),s.addEventListener("input",(()=>{s.value<Number(s.placeholder)?s.setCustomValidity("Минимальная цена "+s.placeholder):s.setCustomValidity(""),s.reportValidity()})),y.addEventListener("click",(()=>{q()})),m.addEventListener("click",(()=>{q()}));const q=function(){for(let e=0;e<f.length;e++)h.get(m.value).includes(f[e].value)?(f[e].disabled=!1,e===f.length-1&&(f[e].selected=!0)):(f[e].disabled=!0,!0===f[e].selected&&(f[e].selected=!1))};r.addEventListener("click",(()=>{const e=o.querySelectorAll("input");for(let t=0;t<e.length;t++)!1===e[t].checkValidity()?e[t].style.outline="solid red 2px":e[t].style.outline="none"}));const b=document.querySelector("#card").content.querySelector(".popup"),E=new Map;E.set("flat","Квартира"),E.set("bungalow","Бунгало"),E.set("house","Дом"),E.set("palace","Дворец");const k=35.68,C=139.69,x=L.map("map-canvas"),w=document.querySelector(".map__filters"),A=L.marker({lat:k,lng:C},{draggable:!0}),D=()=>{A.setLatLng({lat:k,lng:C}),S({lat:k,lng:C})};let V=[];const F=function(e){e.filter((e=>function(e){const t=w.querySelector("#housing-type"),n=w.querySelector("#housing-price"),o=w.querySelector("#housing-rooms"),r=w.querySelector("#housing-guests"),a=Array.from(w.querySelectorAll('[name="features"]:checked')).map((e=>e.value));return(t.value===e.type||"any"===t.value)&&(n.value===function(e){let t;return t=e<1e4?"low":e>=1e4&&e<=5e4?"middle":"high",t}(e.price)||"any"===n.value)&&(o.value===String(e.rooms)||"any"===o.value)&&(r.value===String(e.guests)||"any"===r.value)&&function(e,t){if(0===e.length&&t.length>0)return!1;for(let n=0;n<t.length;n++)for(let o=0;o<e.length;o++)if(-1===e.indexOf(t[n]))return!1;return!0}(e.features,a)}(e.offer))).slice(0,10).forEach((({author:e,offer:t,location:n})=>{const o=L.icon({iconUrl:"/img/pin.svg",iconSize:[52,52],iconAnchor:[26,52]}),r=L.marker({lat:n.lat,lng:n.lng},{draggable:!0,icon:o});V.push(r),r.addTo(x).bindPopup(function({author:e,offer:t}){const n=b.cloneNode(!0);n.querySelector(".popup__title").textContent=t.title,n.querySelector(".popup__text--address").textContent=t.address,n.querySelector(".popup__text--price").textContent=t.price+" ₽/ночь",n.querySelector(".popup__type").textContent=function(e){return E.get(e)}(t.type),n.querySelector(".popup__text--capacity").textContent=t.rooms+" комнаты для "+t.guests+" гостей",n.querySelector(".popup__text--time").textContent="Заезд после "+t.checkin+", выезд до "+t.checkout;const o=n.querySelector(".popup__features");o.innerHTML="",o.appendChild(function(e){const t=document.createDocumentFragment();return e.forEach((e=>{const n=document.createElement("li");n.className="popup__feature popup__feature--"+e,t.appendChild(n)})),t}(t.features)),n.querySelector(".popup__description").textContent=t.description;const r=n.querySelector(".popup__photos"),a=n.querySelector(".popup__photo");return r.removeChild(a),r.appendChild(function(e,t){const n=document.createDocumentFragment();return e.forEach((e=>{t.src=e,n.appendChild(t.cloneNode(!0))})),n}(t.photos,a)),n.querySelector(".popup__avatar").src=e.avatar,n}({author:e,offer:t}),{keepInView:!0})}))},M=function(e){return"Escape"===e.key},N=document.querySelector("#success").content.querySelector(".success").cloneNode(!0),T=document.querySelector("#error").content.querySelector(".error").cloneNode(!0),j=T.querySelector(".error__button"),z=function(e){M(e)&&(e.preventDefault(),U())},R=function(e){e.preventDefault(),U()},U=()=>{document.querySelector("main").removeChild(N),document.removeEventListener("keydown",z),document.removeEventListener("click",R)},I=function(e){M(e)&&(e.preventDefault(),P())},O=function(e){e.preventDefault(),P()},P=()=>{document.querySelector("main").removeChild(T),document.removeEventListener("keydown",I),document.removeEventListener("click",O)};var W,H;j.addEventListener("click",(()=>{P()})),n(726),function(){o.classList.add("ad-form--disabled");for(let e=0;e<a.length;e++)a[e].setAttribute("disabled","disabled")}(),function(){e.classList.add("map__filters--disabled");for(let e=0;e<t.length;e++)t[e].setAttribute("disabled","disabled")}(),x.on("load",(()=>{!function(){o.classList.remove("ad-form--disabled");for(let e=0;e<a.length;e++)a[e].removeAttribute("disabled","disabled");l.setAttribute("readonly","readonly")}(),function(){e.classList.remove("map__filters--disabled");for(let e=0;e<t.length;e++)t[e].removeAttribute("disabled","disabled")}()})).setView({lat:35.68,lng:139.69},10),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(x),function(){const e=L.icon({iconUrl:"/img/main-pin.svg",iconSize:[52,52],iconAnchor:[26,52]});A.setIcon(e),A.addTo(x),S({lat:k,lng:C}),A.on("move",(e=>{S(e.target.getLatLng())}))}(),W=t=>{var n;F(t),n=_.debounce((()=>{V.forEach((e=>{e.remove()})),V=[],F(t)}),500),e.addEventListener("change",(()=>{n()}))},H=e=>{!function(e){const t=document.createElement("div");t.style.zIndex=100,t.style.position="absolute",t.style.left=0,t.style.right=0,t.style.top=0,t.style.padding="10px, 3px",t.style.fontSize="30px",t.style.textAlign="center",t.style.backgroundColor="red",t.textContent=e,document.querySelector("body").appendChild(t),setTimeout((()=>{t.remove()}),4e3)}(e)},fetch("https://22.javascript.pages.academy/keksobooking/data").then((e=>e.json())).then((e=>{W(e)})).catch((()=>{H("Произошла ошибка во время загрузки данных")})),o.addEventListener("submit",(e=>{e.preventDefault(),function(e,t,n){fetch("https://22.javascript.pages.academy/keksobooking",{method:"POST",body:n}).then((n=>{if(n.ok)return e(),!0;t()})).catch((()=>{t()}))}((()=>(document.querySelector("main").appendChild(N),document.addEventListener("keydown",z),document.addEventListener("click",R),void g())),(()=>(document.querySelector("main").appendChild(T),document.addEventListener("keydown",I),void document.addEventListener("click",O))),new FormData(e.target))}))})()})();
//# sourceMappingURL=main.bundle.js.map